{
  lib,
}:
let
  _force_unset = [
    "9P_FSCACHE"
    "9P_FS_POSIX_ACL"
    "AIC79XX_DEBUG_ENABLE"
    "AIC7XXX_DEBUG_ENABLE"
    "AIC94XX_DEBUG"
    "ATH10K_DFS_CERTIFIED"
    "ATH9K_AHB"
    "ATH9K_DFS_CERTIFIED"
    "ATH9K_PCI"
    "B43_PHY_HT"
    "BRCMFMAC_PCIE"
    "BRCMFMAC_USB"
    "BT_HCIBTUSB_AUTOSUSPEND"
    "BT_HCIBTUSB_MTK"
    "BT_HCIUART"
    "BT_HCIUART_BCM"
    "BT_HCIUART_BCSP"
    "BT_HCIUART_H4"
    "BT_HCIUART_LL"
    "BT_HCIUART_QCA"
    "BT_HCIUART_SERDEV"
    "BT_QCA"
    "BT_RFCOMM_TTY"
    "CEPH_FSCACHE"
    "CEPH_FS_POSIX_ACL"
    "CFG80211_CERTIFICATION_ONUS"
    "CFG80211_DEBUGFS"
    "CFG80211_WEXT"
    "CHROMEOS_LAPTOP"
    "CHROMEOS_PSTORE"
    "CHROMEOS_TBMC"
    "CIFS_DFS_UPCALL"
    "CIFS_FSCACHE"
    "CIFS_POSIX"
    "CIFS_UPCALL"
    "CIFS_XATTR"
    "CRC32_SELFTEST"
    "CROS_EC"
    "CROS_EC_I2C"
    "CROS_EC_ISHTP"
    "CROS_EC_LPC"
    "CROS_EC_SPI"
    "CROS_KBD_LED_BACKLIGHT"
    "CRYPTO_TEST"
    "DRM_AMDGPU_CIK"
    "DRM_AMDGPU_SI"
    "DRM_AMDGPU_USERPTR"
    "DRM_AMD_ACP"
    "DRM_AMD_DC_FP"
    "DRM_AMD_DC_SI"
    "DRM_AMD_ISP"
    "DRM_AMD_SECURE_DISPLAY"
    "DRM_I915_GVT"
    "DRM_I915_GVT_KVMGT"
    "DRM_NOUVEAU_GSP_DEFAULT"
    "DRM_NOUVEAU_SVM"
    "FSCACHE_STATS"
    "HAVA_PATA_PLATFORM"
    "HSA_AMD"
    "HVC_XEN"
    "HVC_XEN_FRONTEND"
    "IPW2100_MONITOR"
    "IPW2200_MONITOR"
    "JFS_POSIX_ACL"
    "JFS_SECURITY"
    "MAC80211_DEBUGFS"
    "MAC80211_MESH"
    "MEGARAID_NEWGEN"
    "NET_FC"
    "NFSD_V3_ACL"
    "NFSD_V4"
    "NFSD_V4_SECURITY_LABEL"
    "NFS_FS"
    "NFS_FSCACHE"
    "NFS_LOCALIO"
    "NFS_SWAP"
    "NFS_V3_ACL"
    "NFS_V4_1"
    "NFS_V4_2"
    "NFS_V4_SECURITY_LABEL"
    "NVIDIA_SHIELD_FF"
    "OCFS2_DEBUG_MASKLOG"
    "PCI_XEN"
    "POWER_RESET_GPIO"
    "POWER_RESET_GPIO_RESTART"
    "REISERFS_FS_POSIX_ACL"
    "REISERFS_FS_SECURITY"
    "REISERFS_FS_XATTR"
    "RT2800USB_RT53XX"
    "RT2800USB_RT55XX"
    "RTL8XXXU_UNTESTED"
    "RTW88"
    "RTW88_8822BE"
    "RTW88_8822CE"
    "SATA_HOST"
    "SATA_MOBILE_LPM_POLICY"
    "SCSI_SAS_ATA"
    "SUNRPC_DEBUG"
    "SWIOTLB_XEN"
    "UBIFS_FS_ADVANCED_COMPR"
    "XEN_BACKEND"
    "XEN_BALLOON"
    "XEN_BALLOON_MEMORY_HOTPLUG"
    "XEN_DOM0"
    "XEN_EFI"
    "XEN_HAVE_PVMMU"
    "XEN_MCE_LOG"
    "XEN_PVH"
    "XEN_PVHVM"
    "XEN_SAVE_RESTORE"
    "XEN_SYS_HYPERVISOR"
  ];

  force_unset = lib.lists.foldr
    (item: acc: (acc // { "${item}" = lib.mkForce lib.kernel.unset; }))
    {}
    _force_unset;

  _force_no = [
    "ADFS_FS"
    "AFFS_FS"
    "AGP"
    "BEFS_FS"
    "BFS_FS"
    "CHROME_PLATFORMS"
    "COMEDI"
    "COMPAL_LAPTOP"
    "DVB_A8293"
    "DVB_AF9013"
    "DVB_AF9033"
    "DVB_AS102"
    "DVB_ASCOT2E"
    "DVB_ATBM8830"
    "DVB_AU8522_DTV"
    "DVB_AU8522_V4L"
    "DVB_B2C2_FLEXCOP_PCI"
    "DVB_B2C2_FLEXCOP_USB"
    "DVB_BCM3510"
    "DVB_BUDGET_CORE"
    "DVB_CX22700"
    "DVB_CX22702"
    "DVB_CX24110"
    "DVB_CX24116"
    "DVB_CX24117"
    "DVB_CX24120"
    "DVB_CX24123"
    "DVB_CXD2099"
    "DVB_CXD2820R"
    "DVB_CXD2841ER"
    "DVB_CXD2880"
    "DVB_DIB3000MB"
    "DVB_DIB3000MC"
    "DVB_DIB7000M"
    "DVB_DIB7000P"
    "DVB_DIB8000"
    "DVB_DIB9000"
    "DVB_DM1105"
    "DVB_DRX39XYJ"
    "DVB_DRXD"
    "DVB_DRXK"
    "DVB_DS3000"
    "DVB_DUMMY_FE"
    "DVB_EC100"
    "DVB_HELENE"
    "DVB_HORUS3A"
    "DVB_ISL6405"
    "DVB_ISL6421"
    "DVB_ISL6423"
    "DVB_IX2505V"
    "DVB_L64781"
    "DVB_LG2160"
    "DVB_LGDT3305"
    "DVB_LGDT3306A"
    "DVB_LGDT330X"
    "DVB_LGS8GL5"
    "DVB_LGS8GXX"
    "DVB_LNBH25"
    "DVB_LNBH29"
    "DVB_LNBP21"
    "DVB_LNBP22"
    "DVB_M88DS3103"
    "DVB_M88RS2000"
    "DVB_MB86A16"
    "DVB_MB86A20S"
    "DVB_MN88443X"
    "DVB_MN88472"
    "DVB_MN88473"
    "DVB_MT312"
    "DVB_MT352"
    "DVB_MXL5XX"
    "DVB_MXL692"
    "DVB_NXT200X"
    "DVB_NXT6000"
    "DVB_OR51132"
    "DVB_OR51211"
    "DVB_PLL"
    "DVB_PLUTO2"
    "DVB_PT1"
    "DVB_RTL2830"
    "DVB_RTL2832"
    "DVB_RTL2832_SDR"
    "DVB_S5H1409"
    "DVB_S5H1411"
    "DVB_S5H1420"
    "DVB_S5H1432"
    "DVB_S921"
    "DVB_SI2165"
    "DVB_SI2168"
    "DVB_SI21XX"
    "DVB_SP2"
    "DVB_SP887X"
    "DVB_STB0899"
    "DVB_STB6000"
    "DVB_STB6100"
    "DVB_STV0288"
    "DVB_STV0297"
    "DVB_STV0299"
    "DVB_STV0367"
    "DVB_STV0900"
    "DVB_STV090x"
    "DVB_STV0910"
    "DVB_STV6110"
    "DVB_STV6110x"
    "DVB_STV6111"
    "DVB_TC90522"
    "DVB_TDA10021"
    "DVB_TDA10023"
    "DVB_TDA10048"
    "DVB_TDA1004X"
    "DVB_TDA10071"
    "DVB_TDA10086"
    "DVB_TDA18271C2DD"
    "DVB_TDA665x"
    "DVB_TDA8083"
    "DVB_TDA8261"
    "DVB_TDA826X"
    "DVB_TS2020"
    "DVB_TTUSB_BUDGET"
    "DVB_TUA6100"
    "DVB_TUNER_CX24113"
    "DVB_TUNER_DIB0070"
    "DVB_TUNER_DIB0090"
    "DVB_TUNER_ITD1000"
    "DVB_USB"
    "DVB_USB_V2"
    "DVB_VES1820"
    "DVB_VES1X93"
    "DVB_ZD1301_DEMOD"
    "DVB_ZL10036"
    "DVB_ZL10039"
    "DVB_ZL10353"
    "FIREWIRE"
    "GFS2_FS"
    "GREYBUS"
    "HPFS_FS"
    "JFFS2_FS"
    "JFS_FS"
    "LG_LAPTOP"
    "MANTIS_CORE"
    "MEDIA_TUNER_E4000"
    "MEDIA_TUNER_FC0011"
    "MEDIA_TUNER_FC0012"
    "MEDIA_TUNER_FC0013"
    "MEDIA_TUNER_FC2580"
    "MEDIA_TUNER_IT913X"
    "MEDIA_TUNER_M88RS6000T"
    "MEDIA_TUNER_MAX2165"
    "MEDIA_TUNER_MC44S803"
    "MEDIA_TUNER_MSI001"
    "MEDIA_TUNER_MT2060"
    "MEDIA_TUNER_MT2063"
    "MEDIA_TUNER_MT20XX"
    "MEDIA_TUNER_MT2131"
    "MEDIA_TUNER_MT2266"
    "MEDIA_TUNER_MXL301RF"
    "MEDIA_TUNER_MXL5005S"
    "MEDIA_TUNER_MXL5007T"
    "MEDIA_TUNER_QM1D1B0004"
    "MEDIA_TUNER_QM1D1C0042"
    "MEDIA_TUNER_QT1010"
    "MEDIA_TUNER_R820T"
    "MEDIA_TUNER_SI2157"
    "MEDIA_TUNER_SIMPLE"
    "MEDIA_TUNER_TDA18212"
    "MEDIA_TUNER_TDA18218"
    "MEDIA_TUNER_TDA18250"
    "MEDIA_TUNER_TDA18271"
    "MEDIA_TUNER_TDA827X"
    "MEDIA_TUNER_TDA8290"
    "MEDIA_TUNER_TDA9887"
    "MEDIA_TUNER_TEA5761"
    "MEDIA_TUNER_TEA5767"
    "MEDIA_TUNER_TUA9001"
    "MEDIA_TUNER_XC2028"
    "MEDIA_TUNER_XC4000"
    "MEDIA_TUNER_XC5000"
    "MINIX_FS"
    "NETWORK_FILESYSTEMS"
    "OCFS2_FS"
    "OMFS_FS"
    "ORANGEFS_FS"
    "PANASONIC_LAPTOP"
    "QNX4FS_FS"
    "QNX6FS_FS"
    "RADIO_ADAPTERS"
    "SLAB_FREELIST_HARDENED"
    "SND_ES1968_RADIO"
    "SND_FM801_TEA575X_BOOL"
    "SONY_LAPTOP"
    "SURFACE_PLATFORMS"
    "TOPSTAR_LAPTOP"
    "UBIFS_FS"
    "USB_MSI2500"
    "VIDEO_BT848"
    "VIDEO_CX88_DVB"
    "VIDEO_SAA7134_DVB"
    "VXFS_FS"
    "X86_ANDROID_TABLETS"
    "X86_EXTENDED_PLATFORM"
    "X86_PLATFORM_DRIVERS_DELL"
    "X86_PLATFORM_DRIVERS_HP"
    "XEN"
    "ZONEFS_FS"
    # "MISC_FILESYSTEMS" # sigh... some acpi stuff requires it
    # "VBOXSF_FS"
  ];

  force_no = lib.lists.foldr
    (item: acc: (acc // { "${item}" = lib.mkForce lib.kernel.no; }))
    {}
    _force_no;

  _soft_no = [
    "ATA"
    "BT"
    "DRM_AMDGPU"
    "DRM_I915"
    "DRM_NOUVEAU"
    "DRM_NOVA"
    "DRM_RADEON"
    "WIRELESS"
    "WLAN"
  ];

  soft_no = lib.lists.foldr
    (item: acc: (acc // { "${item}" = lib.kernel.no; }))
    {}
    _soft_no;
in
  (force_unset // force_no // soft_no)


